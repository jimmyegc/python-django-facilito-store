{% load static %}
{% url 'login' as login %}
{% url 'register' as register %}
{% url 'carts:cart' as cart %}
{% url 'shipping_addresses:shipping_addresses' as shipping_addresses %}
{% url 'orders:completeds' as completeds %}
{% url 'billing_profiles:billing_profiles' as billing_profiles %}
<nav class="fixed w-full top-0 z-50 shadow-md backdrop-blur-md transition-colors duration-300"
  style="background-color: rgb(var(--color-bg-card)); color: rgb(var(--color-text));">
  <div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between gap-4">

    <!-- LOGO -->
    <a href="{% url 'index' %}" class="flex items-center gap-2 font-bold text-xl transition"
      style="color: rgb(var(--color-primary));">
      <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg" alt="PyStore" class="w-10">
      PyStore
    </a>

    <!-- Botón de tema -->
    <button id="theme-toggle" class="p-2 rounded-full transition"
      style="background-color: rgba(var(--color-primary), 0.15); color: rgb(var(--color-text));">
      <span id="theme-icon" class="text-lg">🌞</span>
    </button>

    <!-- LINKS DERECHA -->
    <div class="flex items-center gap-4 text-sm font-medium">
      {% if user.is_authenticated %}
      <a href="{{ completeds }}" class="flex items-center gap-1 hover:opacity-80 transition">📦 Pedidos</a>
      <a href="{{ billing_profiles }}" class="flex items-center gap-1 hover:opacity-80 transition">💳 Pagos</a>
      <a href="{{ shipping_addresses }}" class="flex items-center gap-1 hover:opacity-80 transition">📍 Direcciones</a>

      <a href="{{ cart }}" class="relative flex items-center gap-1 hover:opacity-80 transition">
        🛒 Carrito
        {% if cart_item_count > 0 %}
        <span class="absolute -top-2 -right-3 text-xs font-bold px-1.5 py-0.5 rounded-full"
          style="background-color: rgb(var(--color-primary)); color: rgb(var(--color-bg-card));">
          {{ cart_item_count }}
        </span>
        {% endif %}
      </a>

      <a href="{% url 'logout' %}" class="flex items-center gap-1 hover:opacity-80 transition">🚪 Logout</a>
      {% else %}
      <a href="{{ login }}"
        class="flex items-center gap-1 transition hover:opacity-80 {% if request.path == login %}font-semibold{% endif %}">
        🔐 Login
      </a>
      <a href="{{ register }}"
        class="flex items-center gap-1 transition hover:opacity-80 {% if request.path == register %}font-semibold{% endif %}">
        🧾 Registro
      </a>
      {% endif %}
    </div>

    <!-- Botón menú móvil -->
    <button id="menu-btn" class="md:hidden focus:outline-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <!-- MENÚ MÓVIL -->
  <ul id="mobile-menu" class="hidden flex-col gap-2 px-4 pb-4 md:hidden text-sm font-medium">
    {% if user.is_authenticated %}
    <li><a href="{{ completeds }}" class="block py-1 hover:opacity-80">Mis pedidos</a></li>
    <li><a href="{{ shipping_addresses }}" class="block py-1 hover:opacity-80">Mis direcciones</a></li>
    <li><a href="{% url 'logout' %}" class="block py-1 hover:opacity-80">Logout</a></li>
    {% else %}
    <li><a href="{{ login }}" class="block py-1 hover:opacity-80">Login</a></li>
    <li><a href="{{ register }}" class="block py-1 hover:opacity-80">Registro</a></li>
    {% endif %}
    <li><a href="{{ cart }}" class="block py-1 hover:opacity-80">Carrito</a></li>
  </ul>
</nav>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const icon = document.getElementById("theme-icon");
  const root = document.documentElement;

  if (localStorage.theme === 'dark') {
    root.classList.add('dark');
    icon.textContent = '🌙';
  }

  themeToggle.addEventListener("click", () => {
    root.classList.toggle("dark");
    const isDark = root.classList.contains("dark");
    localStorage.theme = isDark ? 'dark' : 'light';
    icon.textContent = isDark ? '🌙' : '🌞';
  });
</script>