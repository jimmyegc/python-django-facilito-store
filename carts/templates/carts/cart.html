{% extends 'base.html' %}
{% load product_extras %}

{% block content %}
{% if cart.products.all %}
<div class="overflow-x-auto">
  <table class="min-w-full bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
    <thead class="bg-gray-100 dark:bg-gray-700">
      <tr>
        <th class="px-4 py-3 text-left text-gray-600 dark:text-gray-300">#</th>
        <th class="px-4 py-3 text-left text-gray-600 dark:text-gray-300">Imagen</th>
        <th class="px-4 py-3 text-left text-gray-600 dark:text-gray-300">Producto</th>
        <th class="px-4 py-3 text-center text-gray-600 dark:text-gray-300">Cantidad</th>
        <th class="px-4 py-3 text-right text-gray-600 dark:text-gray-300">Precio</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
      {% for cp in cart.products_related %}
      {% with product=cp.product %}
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
        <td class="px-4 py-3">{{ forloop.counter }}</td>
        <td class="px-4 py-3">
          {% if product.image %}
          <img src="{{ product.image.url }}" alt="{{ product.title }}" class="w-16 h-16 object-cover rounded">
          {% else %}
          <div
            class="w-16 h-16 bg-gray-200 dark:bg-gray-600 rounded flex items-center justify-center text-gray-400 dark:text-gray-300">
            N/A</div>
          {% endif %}
        </td>
        <td class="px-4 py-3">
          <div class="flex flex-col">
            <a href="{% url 'products:product' product.slug %}"
              class="text-blue-600 dark:text-blue-400 hover:underline">
              {{ product.title }}
            </a>
            <br>
            {% include 'carts/snippets/remove.html' %}
          </div>
        </td>
        <td class="px-4 py-3 text-center">{{ cp.quantity }}</td>
        <td class="px-4 py-3 text-right font-medium text-gray-700 dark:text-gray-200">{{ product.price | price_format }}
        </td>
      </tr>
      {% endwith %}
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Subtotal y acciones -->
<div
  class="mt-6 flex flex-col md:flex-row md:justify-between md:items-center bg-white dark:bg-gray-800 p-4 shadow rounded-lg">
  <div class="text-gray-700 dark:text-gray-200 font-semibold text-lg">
    Subtotal({{ cart.products.count }}): <span class="text-orange-500">{{ cart.subtotal | price_format }}</span>
  </div>
  <div class="mt-4 md:mt-0 flex gap-3">
    <a href="{% url 'index' %}"
      class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-6 py-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition">
      Seguir comprando
    </a>
    <a href="{% url 'orders:order' %}"
      class="bg-orange-500 text-white px-6 py-2 rounded-full hover:bg-orange-600 transition">
      Proceder al pago
    </a>
  </div>
</div>

{% else %}
<div
  class="flex flex-col items-center justify-center min-h-[60vh] text-center bg-gray-50 dark:bg-gray-900 px-4 rounded-2xl shadow-inner">
  <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-md max-w-md w-full">
    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-4 w-16 h-16 text-gray-400 dark:text-gray-300" fill="none"
      viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
        d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2 9m12-9l2 9m-6-9v9" />
    </svg>

    <h2 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-2">Tu carrito estÃ¡ vacÃ­o ðŸ›’</h2>
    <p class="text-gray-500 dark:text-gray-400 mb-6">Parece que aÃºn no has agregado ningÃºn producto. Â¡Explora nuestras
      ofertas y encuentra algo que te encante!</p>

    <a href="{% url 'index' %}"
      class="inline-block bg-orange-500 text-white px-6 py-2 rounded-full font-medium hover:bg-orange-600 transition">
      Seguir comprando
    </a>
  </div>
</div>
{% endif %}
{% endblock %}